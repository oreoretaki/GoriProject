# å…±é€šãƒ™ãƒ¼ã‚¹è¨­å®š - Baselineã¨T5å®Ÿé¨“ã§çµ±ä¸€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
# seq_len=128ã€loss weightsã‚’çµ±ä¸€ã—ã¦ç´”ç²‹æ¯”è¼ƒ

# ãƒ‡ãƒ¼ã‚¿è¨­å®š
data:
  seq_len: 128  # çµ±ä¸€ã‚·ãƒ¼ã‚±ãƒ³ã‚¹é•·
  n_timeframes: 6                 # TFæ•° (M1, M5, M15, M30, H1, H4)
  n_features: 6                   # ç‰¹å¾´é‡æ•° [open, high, low, close, Î”close, %body]
  total_channels: 36              # 6ç‰¹å¾´é‡ Ã— 6TF = 36ãƒãƒ£ãƒ³ãƒãƒ«
  timeframes:
    - m1
    - m5  
    - m15
    - m30
    - h1
    - h4
  data_dir: "../data/derived"
  stats_file: "stats.json"
  # ğŸ”¥ Drop-in Sampling: ãƒ‡ãƒ¼ã‚¿ä¸å‡è¡¡å¯¾ç­–ï¼ˆçŸ­TFã®é‡è¤‡ç‡ã‚’ä¸‹ã’ã‚‹ï¼‰
  sampling_probs:
    m1: 1.00    # ğŸ”¥ M1ã¯å¿…ãšæ®‹ã™ï¼ˆCross-lossè¨ˆç®—ã«å¿…è¦ï¼‰
    m5: 0.40    # ä¸­é »åº¦ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
    m15: 0.55   # ä¸­é »åº¦ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
    m30: 0.70   # é«˜é »åº¦ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
    h1: 0.85    # é«˜é »åº¦ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°
    h4: 1.00    # æœ€é«˜é »åº¦ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°

# ãƒ¢ãƒ‡ãƒ«å…±é€šè¨­å®š
model:
  # TFå›ºæœ‰ã‚¹ãƒ†ãƒ 
  tf_stem:
    kernel_size: 3
    d_model: 128
    
  # å…±æœ‰ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼  
  encoder:
    n_layers: 6
    d_model: 128
    d_state: 16
    d_conv: 4
    expand: 2
    cross_attn_every: 2
    flash_attn: true
    
  # Bottleneck
  bottleneck:
    latent_len: 32                # seq_len/4 = 128/4 = 32ï¼ˆå‹•çš„è¨ˆç®—ï¼‰
    stride: 4
    
  # ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼
  decoder:
    n_layers: 4
    kernel_size: 3
    
  # ä½ç½®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
  positional:
    intra_tf: "rotary"
    inter_tf: "learned"
  
# å­¦ç¿’è¨­å®š
training:
  batch_size: 32              # ãƒãƒ©ãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ï¼šé©åº¦ãªå­¦ç¿’é€Ÿåº¦
  epochs: 40                  # æœ€å¤§ã‚¨ãƒãƒƒã‚¯æ•°
  learning_rate: 1e-3
  weight_decay: 1e-4
  warmup_epochs: 3            # å»¶é•·ï¼š2â†’3ã‚¨ãƒãƒƒã‚¯
  accumulate_grad_batches: 8
  gradient_clip: 0.012        # 5å€ãƒ‡ãƒ¼ã‚¿å¯¾å¿œã§ç·©å’Œï¼ˆ0.008â†’0.012ï¼‰
  precision: "bf16"           # H100æœ€é©åŒ–ï¼šBF16ã§Tensor Coreæ´»ç”¨
  
  # æ—©æœŸåœæ­¢è¨­å®š
  early_stop:
    patience: 5
    min_delta: 0.001
  
  # çµ±ä¸€ã•ã‚ŒãŸã‚ªãƒ—ãƒ†ã‚£ãƒã‚¤ã‚¶ãƒ¼è¨­å®š
  optimizer:
    name: "AdamW"
    lr: 1.5e-3                        # ãƒ˜ãƒƒãƒ‰ & Adapter ç”¨ã®åŸºæº– LRï¼ˆLR Finder v4æ¨å¥¨å€¤ - ãƒãƒƒãƒã‚µã‚¤ã‚º1024ç”¨ï¼‰
    betas: [0.9, 0.98]
    weight_decay: 0.01
    
  # Layerwise LR Decayè¨­å®š
  layerwise_lr_decay: 0.90             # ä¸‹ä½å±¤ã»ã© LR ã‚’ 0.90 å€ãšã¤æ¸›è¡°ï¼ˆç·©å’Œï¼‰
  t5_lr_top: 3.7e-4                    # T5 ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€æœ€ä¸Šå±¤ç”¨ LRï¼ˆLR Finder v4æ¨å¥¨å€¤ - ãƒãƒƒãƒã‚µã‚¤ã‚º1024ç”¨ï¼‰
    
  # çµ±ä¸€ã•ã‚ŒãŸLRã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼è¨­å®š
  scheduler:
    name: "linear_with_warmup"  # Linear Warmup + Cosine Decay
    max_lr: 1.5e-3              # æœ€å¤§å­¦ç¿’ç‡ï¼ˆLR Finder v4æ¨å¥¨å€¤ - ãƒãƒƒãƒã‚µã‚¤ã‚º1024ç”¨ï¼‰
    div_factor: 10.0            # OneCycleLRç”¨ï¼ˆäº’æ›æ€§ä¿æŒï¼‰
    final_div_factor: 50
    pct_start: 0.10             
    interval: "step"            # ã‚¹ãƒ†ãƒƒãƒ—å˜ä½ã§æ›´æ–°

# ãƒã‚¹ã‚­ãƒ³ã‚°è¨­å®š
masking:
  mask_ratio: 0.15
  mask_span_min: 3
  mask_span_max: 10
  sync_across_tf: false          # H4å•é¡Œå›é¿ã®ãŸã‚å„TFç‹¬ç«‹ãƒã‚¹ã‚¯
  mask_token_lr_scale: 1.0       # ãƒã‚¹ã‚¯ãƒˆãƒ¼ã‚¯ãƒ³ã®å­¦ç¿’ç‡ã‚¹ã‚±ãƒ¼ãƒ«

# æ­£è¦åŒ–è¨­å®š
normalization:
  method: "zscore"
  per_tf: true

# ãƒ­ã‚¹è¨­å®šï¼ˆçµ±ä¸€ï¼‰
loss:
  weights:
    recon_tf: 0.6
    spec_tf: 0.01       # ğŸ”¥ ã•ã‚‰ã«åŠåˆ†ã«å‰Šæ¸›ï¼ˆé«˜å‘¨æ³¢æŠ‘åˆ¶ï¼‰
    cross: 0.02         # ğŸ”¥ 33%å¢—åŠ ï¼ˆã‚¯ãƒ­ã‚¹æ•´åˆæ€§é‡è¦–ï¼‰
    amp_phase: 0.02     # ğŸ”¥ 60%å‰Šæ¸›ï¼ˆä½ç›¸æå¤±æŠ‘åˆ¶ï¼‰
  huber_delta: 1.0
  stft_scales: [128, 256]

# ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µï¼ˆç„¡åŠ¹åŒ–ï¼‰
augmentation:
  ddim_noise:
    probability: 0.0
  time_warp:
    probability: 0.0
  regime_mix:
    probability: 0.0

# æ¤œè¨¼ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹
validation:
  val_split: 0.2
  val_gap_days: 60.0             # è¨“ç·´ã¨æ¤œè¨¼ã®é–“ã®æ™‚é–“çš„ã‚®ãƒ£ãƒƒãƒ—ï¼ˆæ—¥æ•°ï¼‰- 60æ—¥é–“ã§å®Œå…¨åˆ†é›¢
  metrics:
    - "correlation_per_tf"
    - "consistency_ratio"
    - "spectral_delta"

# è©•ä¾¡è¨­å®š
evaluation:
  eval_mask_ratio: null          # è©•ä¾¡æ™‚ã®ãƒã‚¹ã‚¯ç‡ (null=é€šå¸¸, 0=ãƒã‚¹ã‚¯ãªã—, 1=å…¨ãƒã‚¹ã‚¯)

# ãƒ­ã‚°ãƒ»ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆï¼ˆ10ã‚¨ãƒãƒƒã‚¯æœ€é©åŒ–ï¼‰
logging:
  log_every_n_steps: 10
  checkpoint_every_n_epochs: 1    # æ¯ã‚¨ãƒãƒƒã‚¯è©•ä¾¡
  save_top_k: 2                   # ãƒ™ã‚¹ãƒˆ2ã®ã¿ä¿å­˜ï¼ˆãƒ‡ã‚£ã‚¹ã‚¯ç¯€ç´„ï¼‰
  monitor: "val_correlation_mean"
  progress_bar_refresh_rate: 50

# å®Ÿè¡Œè¨­å®š
runtime:
  seed: 42

# DataLoaderè¨­å®šï¼ˆBus errorå¯¾ç­–ï¼‰
dataloader:
  num_workers: 4                  # 8ã‹ã‚‰å‰Šæ¸›ã§ãƒ¡ãƒ¢ãƒªç¯€ç´„
  pin_memory: false               # Bus errorå›é¿
  persistent_workers: false       # ãƒ¡ãƒ¢ãƒªç¯€ç´„
  prefetch_factor: 2              # 4ã‹ã‚‰å‰Šæ¸›

# é–‹ç™ºç”¨è¨­å®š
development:
  limit_train_batches: 200        # ãƒ©ã‚¤ãƒˆç‰ˆæ¤œè¨¼ç”¨
  limit_val_batches: 40           # ãƒ©ã‚¤ãƒˆç‰ˆæ¤œè¨¼ç”¨

# LR Finderè¨­å®š
lr_finder:
  enabled: false                  # LR Finderå®Œäº† - é€šå¸¸è¨“ç·´ãƒ¢ãƒ¼ãƒ‰
  min_lr: 1e-8                   # é–‹å§‹å­¦ç¿’ç‡
  max_lr: 1.0                    # çµ‚äº†å­¦ç¿’ç‡
  num_training: 100              # å­¦ç¿’ã‚¹ãƒ†ãƒƒãƒ—æ•°
  mode: "exponential"            # å­¦ç¿’ç‡å¢—åŠ æ–¹æ³•
  save_path: "lr_finder_results" # çµæœä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª