[rank: 0] Seed set to 42
Using 16bit Automatic Mixed Precision (AMP)
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]
Loading `train_dataloader` to estimate number of stepping batches.
🚀 Stage 1 訓練開始
   設定ファイル: configs/t5_baseline.yaml
   データディレクトリ: ../data/derived
   デバイス数: 1
📊 データローダー作成中...
🔄 Stage 1 Dataset初期化 (train)
   データディレクトリ: ../data/derived
   時間足: ['m1', 'm5', 'm15', 'm30', 'h1', 'h4']
   シーケンス長: 64
   M1: 3,104,383レコード, 期間: 2017-01-03 08:00:00+00:00 - 2025-06-17 23:24:00+00:00
   M5: 630,474レコード, 期間: 2017-01-03 08:00:00+00:00 - 2025-06-17 23:20:00+00:00
   M15: 210,477レコード, 期間: 2017-01-03 08:00:00+00:00 - 2025-06-17 23:15:00+00:00
   M30: 105,252レコード, 期間: 2017-01-03 08:00:00+00:00 - 2025-06-17 23:00:00+00:00
   H1: 52,632レコード, 期間: 2017-01-03 08:00:00+00:00 - 2025-06-17 23:00:00+00:00
   H4: 13,601レコード, 期間: 2017-01-03 08:00:00+00:00 - 2025-06-17 20:00:00+00:00
🔧 FeatureEngineer初期化
   特徴量数: 6
   特徴量: ['open', 'high', 'low', 'close', 'delta_close', 'body_ratio']
📏 TFNormalizer初期化
   統計ファイル: ../data/derived/stats.json
   キャッシュ有効: True
📂 正規化統計ロード完了: 2個のTF
🔄 MultiTFWindowSampler初期化 (train)
   📂 キャッシュからウィンドウ読み込み: windows_0ef31b94.npy
   ⚡ ウィンドウ処理時間: 22.43秒
   総ウィンドウ数: 3104320
   trainウィンドウ数: 2483456
🎭 MaskingStrategy初期化
   マスク率: 0.15
   スパン範囲: 3-10
   TF間同期: True
🔄 Stage 1 Dataset初期化 (val)
   データディレクトリ: ../data/derived
   時間足: ['m1', 'm5', 'm15', 'm30', 'h1', 'h4']
   シーケンス長: 64
   M1: 3,104,383レコード, 期間: 2017-01-03 08:00:00+00:00 - 2025-06-17 23:24:00+00:00
   M5: 630,474レコード, 期間: 2017-01-03 08:00:00+00:00 - 2025-06-17 23:20:00+00:00
   M15: 210,477レコード, 期間: 2017-01-03 08:00:00+00:00 - 2025-06-17 23:15:00+00:00
   M30: 105,252レコード, 期間: 2017-01-03 08:00:00+00:00 - 2025-06-17 23:00:00+00:00
   H1: 52,632レコード, 期間: 2017-01-03 08:00:00+00:00 - 2025-06-17 23:00:00+00:00
   H4: 13,601レコード, 期間: 2017-01-03 08:00:00+00:00 - 2025-06-17 20:00:00+00:00
🔧 FeatureEngineer初期化
   特徴量数: 6
   特徴量: ['open', 'high', 'low', 'close', 'delta_close', 'body_ratio']
📏 TFNormalizer初期化
   統計ファイル: ../data/derived/stats.json
   キャッシュ有効: True
📂 正規化統計ロード完了: 2個のTF
🔄 MultiTFWindowSampler初期化 (val)
   📂 キャッシュからウィンドウ読み込み: windows_0ef31b94.npy
   ⚡ ウィンドウ処理時間: 21.97秒
   総ウィンドウ数: 3104320
   valウィンドウ数: 620864
🎭 MaskingStrategy初期化
   マスク率: 0.15
   スパン範囲: 3-10
   TF間同期: True
📊 DataLoader作成完了
   訓練: 38804バッチ (2483456サンプル)
   検証: 9701バッチ (620864サンプル)
   最適化: num_workers=4, prefetch=2
🧠 モデル初期化中...
📦 従来のSharedEncoderを使用します
🎯 Stage1CombinedLoss初期化
   損失重み: {'recon_tf': 0.6, 'spec_tf': 0.2, 'cross': 0.15, 'amp_phase': 0.05}
⚡ Stage1LightningModule初期化完了
   モデル情報: {'total_parameters': 506728, 'trainable_parameters': 506728, 'model_size_mb': 1.933013916015625, 'architecture': {'n_tf': 6, 'seq_len': 64, 'n_features': 6, 'd_model': 64, 'latent_len': 'dynamic(16)'}}

  | Name      | Type               | Params | Mode 
---------------------------------------------------------
0 | model     | Stage1Model        | 506 K  | train
1 | criterion | Stage1CombinedLoss | 0      | train
---------------------------------------------------------
506 K     Trainable params
0         Non-trainable params
506 K     Total params
2.027     Total estimated model params size (MB)
141       Modules in train mode
0         Modules in eval mode
Sanity Checking: |          | 0/? [00:00<?, ?it/s]Sanity Checking:   0%|          | 0/2 [00:00<?, ?it/s]Sanity Checking DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s]Sanity Checking DataLoader 0: 100%|██████████| 2/2 [00:04<00:00,  0.43it/s]                                                                           Training: |          | 0/? [00:00<?, ?it/s]Training:   0%|          | 0/100 [00:00<?, ?it/s]Epoch 0:   0%|          | 0/100 [00:00<?, ?it/s] Epoch 0:  10%|█         | 10/100 [00:40<06:02,  0.25it/s]Epoch 0:  10%|█         | 10/100 [00:40<06:02,  0.25it/s, lr=4.89e-04, grad_norm=2.80e+05, amp=0]Epoch 0:  20%|██        | 20/100 [00:44<02:59,  0.45it/s, lr=4.89e-04, grad_norm=2.80e+05, amp=0]Epoch 0:  20%|██        | 20/100 [00:44<02:59,  0.45it/s, lr=9.22e-04, grad_norm=3.15e+05, amp=0]Epoch 0:  30%|███       | 30/100 [00:49<01:55,  0.61it/s, lr=9.22e-04, grad_norm=3.15e+05, amp=0]Epoch 0:  30%|███       | 30/100 [00:49<01:55,  0.61it/s, lr=1.00e-03, grad_norm=5.96e+05, amp=0]Epoch 0:  40%|████      | 40/100 [00:54<01:21,  0.74it/s, lr=1.00e-03, grad_norm=5.96e+05, amp=0]Epoch 0:  40%|████      | 40/100 [00:54<01:21,  0.74it/s, lr=9.98e-04, grad_norm=7.47e+05, amp=0]Epoch 0:  50%|█████     | 50/100 [00:59<00:59,  0.83it/s, lr=9.98e-04, grad_norm=7.47e+05, amp=0]Epoch 0:  50%|█████     | 50/100 [00:59<00:59,  0.83it/s, lr=9.93e-04, grad_norm=1.00e+03, amp=0]Epoch 0:  60%|██████    | 60/100 [01:05<00:43,  0.92it/s, lr=9.93e-04, grad_norm=1.00e+03, amp=0]Epoch 0:  60%|██████    | 60/100 [01:05<00:43,  0.92it/s, lr=9.87e-04, grad_norm=1.00e+03, amp=0]Epoch 0:  70%|███████   | 70/100 [01:09<00:29,  1.00it/s, lr=9.87e-04, grad_norm=1.00e+03, amp=0]Epoch 0:  70%|███████   | 70/100 [01:09<00:29,  1.00it/s, lr=9.78e-04, grad_norm=8.70e+05, amp=0]Epoch 0:  80%|████████  | 80/100 [01:14<00:18,  1.08it/s, lr=9.78e-04, grad_norm=8.70e+05, amp=0]Epoch 0:  80%|████████  | 80/100 [01:14<00:18,  1.08it/s, lr=9.67e-04, grad_norm=6.20e+05, amp=0]Epoch 0:  90%|█████████ | 90/100 [01:18<00:08,  1.15it/s, lr=9.67e-04, grad_norm=6.20e+05, amp=0]Epoch 0:  90%|█████████ | 90/100 [01:18<00:08,  1.15it/s, lr=9.55e-04, grad_norm=7.24e+05, amp=0]Epoch 0: 100%|██████████| 100/100 [01:22<00:00,  1.21it/s, lr=9.55e-04, grad_norm=7.24e+05, amp=0]Epoch 0: 100%|██████████| 100/100 [01:22<00:00,  1.21it/s, lr=9.40e-04, grad_norm=3.24e+05, amp=0]
Validation: |          | 0/? [00:00<?, ?it/s][A
Validation:   0%|          | 0/20 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/20 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 10/20 [00:12<00:12,  0.78it/s][A
Validation DataLoader 0: 100%|██████████| 20/20 [00:15<00:00,  1.33it/s][A
                                                                        [AEpoch 0: 100%|██████████| 100/100 [01:58<00:00,  0.84it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=9.40e-04, grad_norm=3.24e+05, amp=0]Epoch 0: 100%|██████████| 100/100 [01:58<00:00,  0.84it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=9.40e-04, grad_norm=3.24e+05, amp=0]⚠️ AMPスケールが大幅に減少: 65536.0 → 1024.0
Epoch 0:   0%|          | 0/100 [00:00<?, ?it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=9.40e-04, grad_norm=3.24e+05, amp=0]          Epoch 1:   0%|          | 0/100 [00:00<?, ?it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=9.40e-04, grad_norm=3.24e+05, amp=0]Epoch 1:  10%|█         | 10/100 [00:05<00:45,  1.99it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=9.40e-04, grad_norm=3.24e+05, amp=0]Epoch 1:  10%|█         | 10/100 [00:05<00:45,  1.99it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=9.24e-04, grad_norm=2.16e+05, amp=0]Epoch 1:  20%|██        | 20/100 [00:10<00:43,  1.84it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=9.24e-04, grad_norm=2.16e+05, amp=0]Epoch 1:  20%|██        | 20/100 [00:10<00:43,  1.84it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=9.05e-04, grad_norm=8.00e+04, amp=0]Epoch 1:  30%|███       | 30/100 [00:15<00:35,  1.96it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=9.05e-04, grad_norm=8.00e+04, amp=0]Epoch 1:  30%|███       | 30/100 [00:15<00:35,  1.96it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=8.85e-04, grad_norm=8.74e+04, amp=0]Epoch 1:  40%|████      | 40/100 [00:19<00:29,  2.01it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=8.85e-04, grad_norm=8.74e+04, amp=0]Epoch 1:  40%|████      | 40/100 [00:19<00:29,  2.01it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=8.63e-04, grad_norm=4.53e+04, amp=0]Epoch 1:  50%|█████     | 50/100 [00:24<00:24,  2.05it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=8.63e-04, grad_norm=4.53e+04, amp=0]Epoch 1:  50%|█████     | 50/100 [00:24<00:24,  2.05it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=8.40e-04, grad_norm=1.57e+04, amp=0]Epoch 1:  60%|██████    | 60/100 [00:28<00:18,  2.12it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=8.40e-04, grad_norm=1.57e+04, amp=0]Epoch 1:  60%|██████    | 60/100 [00:28<00:18,  2.12it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=8.15e-04, grad_norm=2.75e+04, amp=0]Epoch 1:  70%|███████   | 70/100 [00:33<00:14,  2.12it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=8.15e-04, grad_norm=2.75e+04, amp=0]Epoch 1:  70%|███████   | 70/100 [00:33<00:14,  2.12it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=7.88e-04, grad_norm=3.10e+04, amp=0]Epoch 1:  80%|████████  | 80/100 [00:37<00:09,  2.15it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=7.88e-04, grad_norm=3.10e+04, amp=0]Epoch 1:  80%|████████  | 80/100 [00:37<00:09,  2.15it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=7.61e-04, grad_norm=4.75e+04, amp=0]Epoch 1:  90%|█████████ | 90/100 [00:42<00:04,  2.11it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=7.61e-04, grad_norm=4.75e+04, amp=0]Epoch 1:  90%|█████████ | 90/100 [00:42<00:04,  2.11it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=7.32e-04, grad_norm=5.65e+04, amp=0]Epoch 1: 100%|██████████| 100/100 [00:47<00:00,  2.11it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=7.32e-04, grad_norm=5.65e+04, amp=0]Epoch 1: 100%|██████████| 100/100 [00:47<00:00,  2.11it/s, val_loss_ep=439.9234, val_loss=446.4352, val_corr_ep=-0.081, val_corr=-0.398, lr=7.03e-04, grad_norm=3.65e+04, amp=0]
Validation: |          | 0/? [00:00<?, ?it/s][A
Validation:   0%|          | 0/20 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/20 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 10/20 [00:02<00:02,  4.17it/s][A
Validation DataLoader 0: 100%|██████████| 20/20 [00:04<00:00,  4.09it/s][A
                                                                        [AEpoch 1: 100%|██████████| 100/100 [00:52<00:00,  1.90it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=7.03e-04, grad_norm=3.65e+04, amp=0]Epoch 1: 100%|██████████| 100/100 [00:52<00:00,  1.90it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=7.03e-04, grad_norm=3.65e+04, amp=0]Epoch 1:   0%|          | 0/100 [00:00<?, ?it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=7.03e-04, grad_norm=3.65e+04, amp=0]          Epoch 2:   0%|          | 0/100 [00:00<?, ?it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=7.03e-04, grad_norm=3.65e+04, amp=0]Epoch 2:  10%|█         | 10/100 [00:12<01:48,  0.83it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=7.03e-04, grad_norm=3.65e+04, amp=0]Epoch 2:  10%|█         | 10/100 [00:12<01:48,  0.83it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=6.72e-04, grad_norm=2.54e+04, amp=0]Epoch 2:  20%|██        | 20/100 [00:16<01:04,  1.24it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=6.72e-04, grad_norm=2.54e+04, amp=0]Epoch 2:  20%|██        | 20/100 [00:16<01:04,  1.24it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=6.41e-04, grad_norm=3.30e+04, amp=0]Epoch 2:  30%|███       | 30/100 [00:22<00:52,  1.35it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=6.41e-04, grad_norm=3.30e+04, amp=0]Epoch 2:  30%|███       | 30/100 [00:22<00:52,  1.35it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=6.09e-04, grad_norm=3.85e+04, amp=0]Epoch 2:  40%|████      | 40/100 [00:26<00:40,  1.49it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=6.09e-04, grad_norm=3.85e+04, amp=0]Epoch 2:  40%|████      | 40/100 [00:26<00:40,  1.49it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=5.77e-04, grad_norm=1.65e+04, amp=0]Epoch 2:  50%|█████     | 50/100 [00:31<00:31,  1.60it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=5.77e-04, grad_norm=1.65e+04, amp=0]Epoch 2:  50%|█████     | 50/100 [00:31<00:31,  1.60it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=5.44e-04, grad_norm=1.66e+04, amp=0]Epoch 2:  60%|██████    | 60/100 [00:35<00:23,  1.69it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=5.44e-04, grad_norm=1.66e+04, amp=0]Epoch 2:  60%|██████    | 60/100 [00:35<00:23,  1.69it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=5.11e-04, grad_norm=3.43e+04, amp=0]Epoch 2:  70%|███████   | 70/100 [00:39<00:17,  1.76it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=5.11e-04, grad_norm=3.43e+04, amp=0]Epoch 2:  70%|███████   | 70/100 [00:39<00:17,  1.76it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=4.78e-04, grad_norm=5.70e+04, amp=0]Epoch 2:  80%|████████  | 80/100 [00:43<00:10,  1.83it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=4.78e-04, grad_norm=5.70e+04, amp=0]Epoch 2:  80%|████████  | 80/100 [00:43<00:10,  1.83it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=4.46e-04, grad_norm=3.36e+04, amp=0]Epoch 2:  90%|█████████ | 90/100 [00:47<00:05,  1.88it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=4.46e-04, grad_norm=3.36e+04, amp=0]Epoch 2:  90%|█████████ | 90/100 [00:47<00:05,  1.88it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=4.13e-04, grad_norm=9.15e+03, amp=0]Epoch 2: 100%|██████████| 100/100 [00:51<00:00,  1.94it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=4.13e-04, grad_norm=9.15e+03, amp=0]Epoch 2: 100%|██████████| 100/100 [00:51<00:00,  1.94it/s, val_loss_ep=232.2915, val_loss=238.1329, val_corr_ep=-0.073, val_corr=-0.227, lr=3.81e-04, grad_norm=3.40e+04, amp=0]
Validation: |          | 0/? [00:00<?, ?it/s][A
Validation:   0%|          | 0/20 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/20 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 10/20 [00:03<00:03,  2.55it/s][A
Validation DataLoader 0: 100%|██████████| 20/20 [00:06<00:00,  3.04it/s][A
                                                                        [AEpoch 2: 100%|██████████| 100/100 [00:58<00:00,  1.70it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=3.81e-04, grad_norm=3.40e+04, amp=0]Epoch 2: 100%|██████████| 100/100 [00:58<00:00,  1.70it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=3.81e-04, grad_norm=3.40e+04, amp=0]Epoch 2:   0%|          | 0/100 [00:00<?, ?it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=3.81e-04, grad_norm=3.40e+04, amp=0]          Epoch 3:   0%|          | 0/100 [00:00<?, ?it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=3.81e-04, grad_norm=3.40e+04, amp=0]Epoch 3:  10%|█         | 10/100 [00:05<00:48,  1.86it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=3.81e-04, grad_norm=3.40e+04, amp=0]Epoch 3:  10%|█         | 10/100 [00:05<00:48,  1.86it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=3.49e-04, grad_norm=5.33e+04, amp=0]Epoch 3:  20%|██        | 20/100 [00:09<00:38,  2.06it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=3.49e-04, grad_norm=5.33e+04, amp=0]Epoch 3:  20%|██        | 20/100 [00:09<00:38,  2.06it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=3.19e-04, grad_norm=3.13e+04, amp=0]Epoch 3:  30%|███       | 30/100 [00:13<00:31,  2.20it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=3.19e-04, grad_norm=3.13e+04, amp=0]Epoch 3:  30%|███       | 30/100 [00:13<00:31,  2.20it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=2.88e-04, grad_norm=4.71e+04, amp=0]Epoch 3:  40%|████      | 40/100 [00:17<00:26,  2.25it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=2.88e-04, grad_norm=4.71e+04, amp=0]Epoch 3:  40%|████      | 40/100 [00:17<00:26,  2.25it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=2.59e-04, grad_norm=3.65e+04, amp=0]Epoch 3:  50%|█████     | 50/100 [00:22<00:22,  2.25it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=2.59e-04, grad_norm=3.65e+04, amp=0]Epoch 3:  50%|█████     | 50/100 [00:22<00:22,  2.25it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=2.31e-04, grad_norm=2.17e+04, amp=0]Epoch 3:  60%|██████    | 60/100 [00:26<00:17,  2.25it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=2.31e-04, grad_norm=2.17e+04, amp=0]Epoch 3:  60%|██████    | 60/100 [00:26<00:17,  2.25it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=2.04e-04, grad_norm=3.14e+04, amp=0]Epoch 3:  70%|███████   | 70/100 [00:32<00:13,  2.15it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=2.04e-04, grad_norm=3.14e+04, amp=0]Epoch 3:  70%|███████   | 70/100 [00:32<00:13,  2.15it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=1.79e-04, grad_norm=2.78e+04, amp=0]Epoch 3:  80%|████████  | 80/100 [00:36<00:09,  2.17it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=1.79e-04, grad_norm=2.78e+04, amp=0]Epoch 3:  80%|████████  | 80/100 [00:36<00:09,  2.17it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=1.54e-04, grad_norm=2.61e+04, amp=0]Epoch 3:  90%|█████████ | 90/100 [00:41<00:04,  2.18it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=1.54e-04, grad_norm=2.61e+04, amp=0]Epoch 3:  90%|█████████ | 90/100 [00:41<00:04,  2.18it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=1.32e-04, grad_norm=2.99e+04, amp=0]Epoch 3: 100%|██████████| 100/100 [00:45<00:00,  2.20it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=1.32e-04, grad_norm=2.99e+04, amp=0]Epoch 3: 100%|██████████| 100/100 [00:45<00:00,  2.20it/s, val_loss_ep=191.2688, val_loss=196.5566, val_corr_ep=-0.077, val_corr=-0.232, lr=1.11e-04, grad_norm=1.44e+04, amp=0]
Validation: |          | 0/? [00:00<?, ?it/s][A
Validation:   0%|          | 0/20 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/20 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 10/20 [00:02<00:02,  4.40it/s][A
Validation DataLoader 0: 100%|██████████| 20/20 [00:04<00:00,  4.20it/s][A
                                                                        [AEpoch 3: 100%|██████████| 100/100 [00:50<00:00,  1.97it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=1.11e-04, grad_norm=1.44e+04, amp=0]Epoch 3: 100%|██████████| 100/100 [00:50<00:00,  1.97it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=1.11e-04, grad_norm=1.44e+04, amp=0]Epoch 3:   0%|          | 0/100 [00:00<?, ?it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=1.11e-04, grad_norm=1.44e+04, amp=0]          Epoch 4:   0%|          | 0/100 [00:00<?, ?it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=1.11e-04, grad_norm=1.44e+04, amp=0]Epoch 4:  10%|█         | 10/100 [00:05<00:46,  1.96it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=1.11e-04, grad_norm=1.44e+04, amp=0]Epoch 4:  10%|█         | 10/100 [00:05<00:46,  1.96it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=9.15e-05, grad_norm=1.34e+04, amp=0]Epoch 4:  20%|██        | 20/100 [00:09<00:38,  2.07it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=9.15e-05, grad_norm=1.34e+04, amp=0]Epoch 4:  20%|██        | 20/100 [00:09<00:38,  2.07it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=7.40e-05, grad_norm=2.01e+04, amp=0]Epoch 4:  30%|███       | 30/100 [00:15<00:36,  1.94it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=7.40e-05, grad_norm=2.01e+04, amp=0]Epoch 4:  30%|███       | 30/100 [00:15<00:36,  1.94it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=5.83e-05, grad_norm=1.55e+04, amp=0]Epoch 4:  40%|████      | 40/100 [00:19<00:29,  2.01it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=5.83e-05, grad_norm=1.55e+04, amp=0]Epoch 4:  40%|████      | 40/100 [00:19<00:29,  2.01it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=4.46e-05, grad_norm=1.85e+04, amp=0]Epoch 4:  50%|█████     | 50/100 [00:24<00:24,  2.08it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=4.46e-05, grad_norm=1.85e+04, amp=0]Epoch 4:  50%|█████     | 50/100 [00:24<00:24,  2.08it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=3.29e-05, grad_norm=2.17e+04, amp=0]Epoch 4:  60%|██████    | 60/100 [00:28<00:18,  2.14it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=3.29e-05, grad_norm=2.17e+04, amp=0]Epoch 4:  60%|██████    | 60/100 [00:28<00:18,  2.14it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=2.33e-05, grad_norm=3.49e+04, amp=0]Epoch 4:  70%|███████   | 70/100 [00:32<00:13,  2.17it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=2.33e-05, grad_norm=3.49e+04, amp=0]Epoch 4:  70%|███████   | 70/100 [00:32<00:13,  2.17it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=1.58e-05, grad_norm=2.86e+04, amp=0]Epoch 4:  80%|████████  | 80/100 [00:36<00:09,  2.19it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=1.58e-05, grad_norm=2.86e+04, amp=0]Epoch 4:  80%|████████  | 80/100 [00:36<00:09,  2.19it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=1.03e-05, grad_norm=2.06e+04, amp=0]Epoch 4:  90%|█████████ | 90/100 [00:41<00:04,  2.19it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=1.03e-05, grad_norm=2.06e+04, amp=0]Epoch 4:  90%|█████████ | 90/100 [00:41<00:04,  2.19it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=7.09e-06, grad_norm=8.64e+03, amp=0]Epoch 4: 100%|██████████| 100/100 [00:46<00:00,  2.14it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=7.09e-06, grad_norm=8.64e+03, amp=0]Epoch 4: 100%|██████████| 100/100 [00:46<00:00,  2.14it/s, val_loss_ep=205.3114, val_loss=210.8161, val_corr_ep=-0.044, val_corr=-0.210, lr=6.01e-06, grad_norm=8.62e+03, amp=0]
Validation: |          | 0/? [00:00<?, ?it/s][A
Validation:   0%|          | 0/20 [00:00<?, ?it/s][A
Validation DataLoader 0:   0%|          | 0/20 [00:00<?, ?it/s][A
Validation DataLoader 0:  50%|█████     | 10/20 [00:02<00:02,  4.12it/s][A
Validation DataLoader 0: 100%|██████████| 20/20 [00:05<00:00,  3.91it/s][A
                                                                        [AEpoch 4: 100%|██████████| 100/100 [00:52<00:00,  1.92it/s, val_loss_ep=204.4490, val_loss=209.8951, val_corr_ep=-0.062, val_corr=-0.250, lr=6.01e-06, grad_norm=8.62e+03, amp=0]Epoch 4: 100%|██████████| 100/100 [00:52<00:00,  1.92it/s, val_loss_ep=204.4490, val_loss=209.8951, val_corr_ep=-0.062, val_corr=-0.250, lr=6.01e-06, grad_norm=8.62e+03, amp=0]`Trainer.fit` stopped: `max_epochs=5` reached.
Epoch 4: 100%|██████████| 100/100 [00:52<00:00,  1.91it/s, val_loss_ep=204.4490, val_loss=209.8951, val_corr_ep=-0.062, val_corr=-0.250, lr=6.01e-06, grad_norm=8.62e+03, amp=0]Using 16bit Automatic Mixed Precision (AMP)
Trainer already configured with model summary callbacks: [<class 'pytorch_lightning.callbacks.model_summary.ModelSummary'>]. Skipping setting a default `ModelSummary` callback.
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

✅ 訓練完了
   最良チェックポイント: /mnt/c/Users/taki/Desktop/my-projects/GoriProject/stage1/checkpoints/stage1-epoch=03-val_correlation_mean=-0.0440.ckpt
   最良スコア: -0.0440245196223259
📈 最終評価実行中...
Testing: |          | 0/? [00:00<?, ?it/s]Testing:   0%|          | 0/20 [00:00<?, ?it/s]Testing DataLoader 0:   0%|          | 0/20 [00:00<?, ?it/s]Testing DataLoader 0:  50%|█████     | 10/20 [00:02<00:02,  3.70it/s]Testing DataLoader 0: 100%|██████████| 20/20 [00:05<00:00,  3.77it/s]Testing DataLoader 0: 100%|██████████| 20/20 [00:05<00:00,  3.75it/s]
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       Test metric             DataLoader 0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
      val_amp_phase         1.9840129613876343
       val_corr_h1          0.23061522841453552
       val_corr_h4                  0.0
       val_corr_m1         0.0013433456188067794
      val_corr_m15         -0.16440430283546448
      val_corr_m30         -0.11651916801929474
       val_corr_m5          -0.0821937546133995
     val_correlation       -0.021859774366021156
  val_correlation_mean     -0.021859774366021156
        val_cross           1212.0455322265625
        val_loss             204.4607696533203
      val_recon_tf           37.5911750793457
       val_spec_tf                  0.0
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
